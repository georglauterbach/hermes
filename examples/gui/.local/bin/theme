#! /usr/bin/env -S bash -eE -u -o pipefail -O inherit_errexit

# TODO use `regolith-look & ; __PID=${!} ; ... ; wait -F "${__PID}" ;`
# TODO find proper GTK color theme

function alacritty_link_colors_to() {
  ln -sf \
    "${HOME}/.config/alacritty/${1:-Alacritty color file required}.toml" \
    "${HOME}/.config/alacritty/33-colors_active.toml"
}

function rofi_change_theme_to() {
  sed -i -E "s/(theme )\".*\"/\1\"${1}\"/" "${HOME}/.config/rofi/config.rasi"
}

function swaylock_link_config_to() {
  ln -sf \
    "${HOME}/.config/swaylock/config_${1:-Color value required}" \
    "${HOME}/.config/swaylock/config"
}

function zellij_set_theme_to() {
  sed -i -E "s/(theme )\".*\"/\1\"${1}\"/" "${HOME}/.config/zellij/config.kdl"
}

case "${1:-dark}" in
  ( 'd' | 'dark' )
    gsettings set org.gnome.desktop.interface      gtk-theme    'Gruvbox'
    gsettings set org.gnome.desktop.interface      icon-theme   'Gruvbox-Plus-Dark'
    gsettings set org.gnome.desktop.interface      color-scheme 'prefer-dark'
    gsettings set org.gnome.desktop.wm.preferences theme        'Gruvbox'

    alacritty_link_colors_to '31-colors_dark'
    rofi_change_theme_to 'gruvbox-material'
    swaylock_link_config_to 'dark'
    zellij_set_theme_to 'gruvbox-material-dark'
    ;;

  ( 'l' | 'light' )
    gsettings set org.gnome.desktop.interface      gtk-theme    'Adwaita'
    gsettings set org.gnome.desktop.interface      icon-theme   'Gruvbox-Plus-Light'
    gsettings set org.gnome.desktop.interface      color-scheme 'prefer-light'
    gsettings set org.gnome.desktop.wm.preferences theme        'Adwaita'

    alacritty_link_colors_to '32-colors_light'
    rofi_change_theme_to 'everforest'
    swaylock_link_config_to 'light'
    zellij_set_theme_to 'everforest'
    ;;

  ( * )
    echo "'${1}' is not a valid option - use 'light|l' or 'dark|d'" >&2
    exit 1
    ;;
esac

exit 0
